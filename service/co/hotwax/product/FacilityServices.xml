<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://moqui.org/xsd/service-definition-3.xsd">
    <service verb="create" noun="FacilityGroup">
        <in-parameters>
            <auto-parameters entity-name="org.apache.ofbiz.product.facility.FacilityGroup" include="all"/>
        </in-parameters>
        <out-parameters>
            <parameter name="facilityGroupId"/>
        </out-parameters>
        <actions>
            <service-call name="create#org.apache.ofbiz.product.facility.FacilityGroup"
                          in-map="context"
                          out-map="result"/>
            <set field="facilityGroupId" from="result.facilityGroupId"/>

            <!--If creating inventory channel facility group-->
            <if condition="facilityGroupTypeId == 'CHANNEL_FAC_GROUP'">
                <!--Create configuration (threshold) facility for the channel created -->
                <set field="facilityId" from="facilityGroupId"/>
                <set field="facilityName" from="facilityGroupName + ' ' +'Config Facility'"/>
                <service-call name="create#org.apache.ofbiz.product.facility.Facility"
                              in-map="context + [facilityId: facilityId, facilityGroupName: facilityName , facilityTypeId: 'CONFIGURATION']"/>
                <service-call name="create#org.apache.ofbiz.product.facility.FacilityGroupMember"
                              in-map="context + [facilityGroupId: facilityGroupId, facilityId: facilityId, fromDate: ec.user.nowTimestamp]"/>
            </if>
            <return message="Facility group #${facilityGroupId} created successfully."/>
        </actions>
    </service>

</services>